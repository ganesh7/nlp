<html>
<body>
<input type="textarea" id="mainText"
value="Forrest Gump is a 1994 American epic romantic comedy-drama film based on the 1986 novel of the same name by Winston Groom . The film was directed by Robert Zemeckis and starred Tom Hanks, Robin Wright, Gary Sinise and Sally Field . The film earned over $677 million worldwide during its theatrical run . Released in the United States on July 6, 1994, Forrest Gump received critical acclaim . Tom Hanks was from United Kingdom . He and Gary Sinise won Best Actor . "></input>


<!-- "Tom Hanks was a Batsman. He and Gary Sinise, who was Bowler, won Best Actor . " -->

<!-- "Tom Hanks was a Batsman. He and Gary Sinise, who was Bowler and was the founder of Hinduism, won Best Actor . " -->

<!-- "Tom Hanks was from United Kingdom . He and Gary Sinise won Best Actor . " -->

<!-- "Forrest Gump is a 1994 American epic romantic comedy-drama film based on the 1986 novel of the same name by Winston Groom . The film was directed by Robert Zemeckis and starred Tom Hanks, Robin Wright, Gary Sinise and Sally Field . The film earned over $677 million worldwide during its theatrical run . Released in the United States on July 6, 1994, Forrest Gump received critical acclaim . Tom Hanks was from United Kingdom . He and Gary Sinise won Best Actor . " -->

<!-- "Inception starred Tom Hanks, Laura Dean, Jack Cross and Jason Bignum . " -->

<!-- "Tom Hanks was a Batsman. He, Gary Sinise, who was Bowler and was the founder of Hinduism, and Laure Singh won Best Actor . " -->


<!-- "Jesus found Chirstianity and Hinduism . He also found Zoran . " -->

<!-- "Tom Hanks was from United Kingdom . He and Gary Sinise won Best Actor . " -->

<!-- "Forrest Gump is a 1994 American epic romantic comedy-drama film based on the 1986 novel of the same name by Winston Groom . The film was directed by Robert Zemeckis and starred Tom Hanks, Robin Wright, Gary Sinise and Sally Field . The film earned over $677 million worldwide during its theatrical run . Released in the United States on July 6, 1994, Forrest Gump received critical acclaim . Tom Hanks was from United Kingdom . He and Gary Sinise won Best Actor . " -->

<!-- "A task considered to be impossible : Inception, the implantation of an idea . " -->
<!-- "A task considered to be impossible is called inception . " -->
<!--  "Inception is a film which starred Adam, Jeff, Sam and Jason . "  -->


<!--  "Inception is a 2010 British-American science fiction heist thriller film written, co-produced, and directed by Christopher Nolan. The film stars a large ensemble cast that includes Leonardo DiCaprio, Ellen Page, Joseph Gordon-Levitt, Marion Cotillard, Ken Watanabe, Tom Hardy, Dileep Rao, Cillian Murphy, Tom Berenger, and Michael Caine. DiCaprio plays Dom Cobb, a professional thief who commits corporate espionage by infiltrating the subconscious of his targets. He is offered a chance of redemption as payment for a task considered to be impossible: 'inception', the implantation of another person's idea into a target's subconscious . " -->

<!-- "Jesus discovered Christianity, which formed Hinduism . " -->

<!---  "Forrest Gump is a 1994 American epic romantic comedy-drama film based on the 1986 novel of the same name by Winston Groom . The film was directed by Robert Zemeckis and starred Tom Hanks, Robin Wright, Gary Sinise and Sally Field . The film earned over $677 million worldwide during its theatrical run . Released in the United States on July 6, 1994, Forrest Gump received critical acclaim . Tom Hanks was from United Kingdom . He won Best Actor . " -->

<!--sInception is a 2010 British-American science fiction heist thriller film written, co-produced, and directed by Christopher Nolan. The film stars a large ensemble cast that includes Leonardo DiCaprio, Ellen Page, Joseph Gordon-Levitt, Marion Cotillard, Ken Watanabe, Tom Hardy, Dileep Rao, Cillian Murphy, Tom Berenger, and Michael Caine. DiCaprio plays Dom Cobb, a professional thief who commits corporate espionage by infiltrating the subconscious of his targets. He is offered a chance of redemption as payment for a task considered to be impossible: 'inception', the implantation of another person's idea into a target's subconscious .  -->
<!--<input type="textarea" id="mainText"
value="Batman is a fictional character, a comic book superhero appearing in comic books published by DC Comics . Batman was created by artist Bob Kane and writer Bill Finger ."></input>-->
<button>Create Graph</button>
<button onclick="generateQuestions()">Generate Questions</button>
<button onclick="displayAnswers()">Generate Q/A</button>
<div id="easyQuestion" value="">
</div>
<div id="mediumQuestion" value="">
</div>
<div id="hardQuestion" value="">
</div>
<div id="easyAnswer" data-text="When was Forrest Gump made ?">
</div>

<div id="testAnswer" data-text="Of the people who starred in Forrest Gump, from where was the actor who won Best Actor ?">
</div>
<!-- Who was a Batsman and the founder of Hinduism ? -->
<div id="mediumAnswer" data-text="Who starred in Forrest Gump ?">
</div>
<div id="hardAnswer" data-text="Of the people who starred in Forrest Gump, from where was the actor who won Best Actor ?">
</div>
<br>
<div id="questionDisplay" value="">
</div>
<div id="answerDisplay" value="">
</div>
<!--- "Forrest Gump is a 1994 American epic romantic comedy-drama film based on the 1986 novel of the same name by Winston Groom . The film was directed by Robert Zemeckis and starred Tom Hanks, Robin Wright, Gary Sinise and Sally Field ." -->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script src="springy.js"></script>
<script src="countries.js"></script>
<script src="springyui.js"></script>
<script type="text/javascript" src="lexer.js"></script>
<script type="text/javascript" src="lexicon.js_"></script>
<script type="text/javascript" src="POSTagger.js"></script>
<script>

var gGraphDict = {}; // dictionary representation of the graph
var subGraphs = {}; // dictionary keying composite name - > array of nodes

function isDTSpecial(word)	{
	word = word.toLowerCase();
	var arr = ["some","a"];
	for (var i = 0 ; i < arr.length ; i++)	{
		if (word === arr[i])	{
			return true;
		}
	}
	return false;
}

function removeFluff(arr)	{
	var newArr = [];
	//var posTags = posTagText(text);
	//var wordArray = posTags[1];
	//var sentence = posTags[0];
	//var tagArray = posTags[2];
	for (var i = 0 ; i < arr.length ; i++)	{
		var word = arr[i];
		if (word === "-")	{
			var prev = newArr[newArr.length-1];
			var temp = prev+"-"+arr[i+1];
			newArr[newArr.length-1] = temp;
			i = i+1;
		}
		//else if (word === ":")	{
		//	newArr.push(",");
		//}
		//else if (word != "'" && word != ":")	{
		//else if (isOppositeComma(word) && i < arr.length - 1 && isComma(arr[i+1]))	{
		//	newArr.push(word);
		//	i = i + 1;
		//}
		else if (isComma(word) && i < arr.length - 1 && isOppositeComma(arr[i+1]))	{
			newArr.push(arr[i+1]);
			i = i + 1;
		}
		else if (isComma(word) && i < arr.length - 1 && isDTSpecial(arr[i+1]))	{
			newArr.push(arr[i]);
			newArr.push("is");
			//newArr.push("a");
			//newArr.push(arr[i+1]);
			i = i + 1;
		}
		else if (word != "'")	{
			newArr.push(word);
		}
	}
	return newArr;

}

function containsSubstring(str1, str2)	{

	var text2 = str2.replace(/[^\w\s]|_/g, function ($1) { return ' ' + $1 + ' ';}).replace(/[ ]+/g, ' ').split(' ');

	for (var i = 0 ; i < text2.length; i++)	{
		if (str1.indexOf(text2[i]) != -1)	{
			return true;
		}
	}
	return false;

}

window.onload = function()	{
	
	var str = document.getElementById("mainText").value;
	var text = str.replace(/[^\w\s]|_/g, function ($1) { return ' ' + $1 + ' ';}).replace(/[ ]+/g, ' ').split(' ');
	text = removeFluff(text);
	text = text.join(" ");
	var obj = processText(text);
	createGraph(obj);
}

function isValidDate(text)	{
	var months = [
		"january",
		"february",
		"march",

		"april",
		"may",
		"june",

		"july",
		"august",
		"september",

		"october",
		"november",
		"december"

	]
	//if (inMonths())	{

	//}
	var z = text.toLowerCase();
	for (var i = 0 ; i < months.length ; i++)	{
		if (z === months[i])	{
			return true;
		}
	}
	if (text.indexOf("novel") != -1)	{
		return false;
	}
	var x = new Date(text);
	var y = Date.parse(x);
	if (isNaN(y) == true)	{
		return false;
	}
	else {
		return true;
	}
}

function displayAnswers()	{
	document.getElementById('questionDisplay').innerHTML = document.getElementById('hardAnswer').dataset.text;
	document.getElementById('answerDisplay').innerHTML = answerQuestions();

}

function generateQuestions()	{
	var q = askQuestions();
	displayQuestions(q);
}

function displayQuestions(questions)	{
	for (var i = 0 ; i < questions.length ; i++)	{
		var question = questions[i];
		var temp = document.getElementById("easyQuestion").innerHTML;
		temp+= "\n"+question;
		document.getElementById("easyQuestion").innerHTML = temp;
	}


}

function reClassify(word, nextWordTag)	{

	word = word.toLowerCase();
	var arr = ["known as","called", ":"];
	if (nextWordTag == "NN")	{
		for (var i = 0 ; i < arr.length ; i++)	{
			if (word.indexOf(arr[i]) != -1)	{
				return true;
			}
		}
	}
	return false;
}


function askQuestions()	{
	var questions = [];
	//for (var i = 0 ; i < graph.nodes.length ; i++)	{
	for (var i = 0 ; i < graph.edges.length ; i++)	{	
		var edge = graph.edges[i];
		var edgeLabel = edge.data.label;
		var source = edge.source;
		var sourceLabel = source.data.label;
		var target = edge.target;
		var targetLabel = target.data.label;
		var str = "";
		switch(edgeLabel) {
		case "date":
		  //return "date"
		  str+= "When was "+sourceLabel+" ?"
		  break;
		case "location":
		  //return "location"
		  str+= "Where was "+sourceLabel+" ?"
		  break;
		default:
			str += "What "+sourceLabel+" "+edgeLabel+" ?"
		  //return "misc"
		}
		//return str;
		questions.push(str);


	}
	return questions;
}

function answerQuestions()	{
	var question1 = document.getElementById('testAnswer').dataset.text;
	return processQuestion4(question1);
	//return processQuestion(question1);
	//return 
}


function processQuestion3(text)	{
	var arr = preProcess(text);
	console.log("preproces",arr);
	var newWords = arr[0];
	var newTags = arr[1];
	var connectorWords = [];
	var nnWords = [];
	for (var i = 0; i < newTags.length ; i++)	{
		var tag = newTags[i];
		if (tag === "connector")	{
			connectorWords.push(newWords[i]);
		}
		else if (tag === "NN")	{
			nnWords.push(newWords[i]);
		}
	}
	var combo = cartesian(nnWords, connectorWords);

	console.log(combo);
	var maxPercentage = 0;
	var similarEdge = null;
	for (var j = 0 ; j < combo.length ; j++)	{
		var keyWord = combo[j][0];
		var keyTag = combo[j][1];
		var answer = searchForSimilarLabels(keyWord, keyTag, null, 0, {}, 100, "");
		if (answer[1] > maxPercentage)	{
			maxPercentage = answer[1];
			similarEdge = answer[0];
		}
	}
	return similarEdge;

}

function replaceQuestionWords(text)	{
	//text = text.toLowerCase();
	var arr = ["where","When"];
	var arrR = ["location","date"];
	for (var i = 0 ; i < arr.length ; i++)	{
		var word = arr[i];
		var wordL = word.toLowerCase();
		var wordR = arrR[i];
		text = text.replace(word, wordR);
		text = text.replace(wordL, wordR);
	}
	return text;

}

function processQuestion4(text)	{
	var originalTextU = text;
	var originalText = text.toLowerCase();
	text = replaceQuestionWords(text);
	var arr = preProcess(text);
	console.log("preproces",arr);
	var newWords = arr[0];
	var newTags = arr[1];
	var connectorWords = [];
	var nnWords = [];
	for (var i = 0; i < newTags.length ; i++)	{
		var tag = newTags[i];
		if (tag === "connector")	{
			connectorWords.push(newWords[i]);
		}
		else if (tag === "NN")	{
			nnWords.push(newWords[i]);
		}
	}
	console.log("BBBBBBBBBBSSSSSSS",nnWords.length === connectorWords.length);
	console.log("BBBBBBBBBBSSSSSSS",nnWords,connectorWords);
	var combo = cartesian(nnWords, connectorWords);
	var combo2 = cartesian(connectorWords, nnWords);

	console.log(combo);
	var maxPercentage = 0;
	var similarEdge = null;
	for (var j = 0 ; j < combo.length ; j++)	{
		var keyWord = combo[j][0];
		var keyTag = combo[j][1];
		var answer = searchForSimilarLabels(keyWord, keyTag, null, 0, {}, 50, "");
		console.log(answer[1]);
		if (answer[1] > maxPercentage)	{
			maxPercentage = answer[1];
			similarEdge = answer[0];
		}
	}
	for (var j = 0 ; j < combo2.length ; j++)	{
		var keyWord = combo2[j][0];
		var keyTag = combo2[j][1];
		var answer = searchForSimilarLabels(keyWord, keyTag, null, 0, {}, 50, "");
		console.log(answer[1]);
		if (answer[1] > maxPercentage)	{
			maxPercentage = answer[1];
			similarEdge = answer[0];
		}
	}

	console.log(similarEdge);
	if (originalText.indexOf("how many") != -1)	{
		//return findAllInGraph(similarEdge);
		return getSimilarIncomingEdges(similarEdge);
	}
	else if (originalTextU.indexOf("Is") != -1 || originalText.indexOf("did") != -1 || originalText.indexOf("would") != -1)	{
		var sSource = similarEdge.source.data.label.toLowerCase();
		var sTarget = similarEdge.target.data.label.toLowerCase();

		if (
			(originalText.indexOf(sSource) != -1 && originalText.indexOf(sTarget) != -1 ) ||

			(containsSubstring(originalText,sSource) && containsSubstring(originalText,sTarget))

			)	{
			return "Yes";
		}
		else {
			return "No";
		}

	}
	else {
		var str = ""+similarEdge.source.data.label+" "+similarEdge.data.label+" "+similarEdge.target.data.label+".";
		/*var sSource = similarEdge.source.data.label.toLowerCase();
		var sTarget = similarEdge.target.data.label.toLowerCase();
		var connector1 = similarEdge.data.label;
		if (originalText.indexOf(sSource) === -1)	{
			return similarEdge.source.data.label;
		}
		else {
			return similarEdge.target.data.label;
		}*/
		
		return str;
	}
	//return similarEdge;

}

//function findAllInGraph(similarEdge)	{

//}

// usage-> cartesian([0,1], [0,1,2,3], [0,1,2])
function cartesian() {
    var r = [], arg = arguments, max = arg.length-1;
    function helper(arr, i) {
        for (var j=0, l=arg[i].length; j<l; j++) {
            var a = arr.slice(0); // clone arr
            a.push(arg[i][j])
            if (i==max) {
                r.push(a);
            } else
                helper(a, i+1);
        }
    }
    helper([], 0);
    return r;
};

function processQuestion2(text)	{
	var arr = preProcess(text);
	console.log("MANG2222222",arr);
	var questionTag = getQuestionTag(arr[0][0]);
	console.log("MANG",questionTag);
	//return "prob";
	var keyTag = "";
	if (questionTag === "misc")	{
		//return "prob"
		keyTag = arr[0][0];
	}
	else {
		keyTag = questionTag;
	}
	var keyWord = "";
	for (var j = 0 ; j < arr[1].length; j++ )	{
		var tag = arr[1][j];
		//console.log("TAGS123",tag)
		var word = arr[0][j];
		if (i === 0)	{
			continue;
		}
		else if (tag.indexOf("NN") === -1) {
			continue;
		}
		else {
			keyWord = word;
		}
	}
	var answer = searchForSimilarLabels(keyWord, keyTag, null, 0, {}, 100, "");
	console.log(answer[0],answer[3],answer);
	return getSimilarIncomingEdges(answer[0],answer[3]);

	//return answer[0].target.data.label;
	//return "abc";
}

function getSimilarIncomingEdges(finalEdge, edgePhrase)	{
	var arr = [];
	for (var i = 0 ; i < finalEdge.source.outgoingEdges.length ; i++)	{
		var sourceEdge = finalEdge.source.outgoingEdges[i];
		var sourceEdgeTargetLabel = sourceEdge.target.data.label
		var sourceEdgeLabel = sourceEdge.data.label;
		if (sourceEdgeLabel === edgePhrase)	{
			arr.push(sourceEdgeTargetLabel);
		}
	}
	return arr;

}

function getSimilarIncomingEdges(finalEdge)	{
	var arr = [];
	var edgePhrase = finalEdge.data.label;
	for (var i = 0 ; i < finalEdge.source.outgoingEdges.length ; i++)	{
		var sourceEdge = finalEdge.source.outgoingEdges[i];
		var sourceEdgeTargetLabel = sourceEdge.target.data.label
		var sourceEdgeLabel = sourceEdge.data.label;
		if (sourceEdgeLabel === edgePhrase)	{
			arr.push(sourceEdgeTargetLabel);
		}
	}
	return arr;

}

	//console.log("HERE",questionTag,keyWord);
function searchForSimilarLabels(keyWord, keyTag, mostSimilarEdge, mostSimilarPercentage, isVisited,counter, mostSimilarEdgeLabel)	{
	counter-=1;
	if (counter < 5)	{
		//return [null,null,null];
		return [mostSimilarEdge, mostSimilarPercentage, isVisited,mostSimilarEdgeLabel];
	}
	//if (mostSimilarPercentage === 100)	{
	//	return [ mostSimilarEdge , mostSimilarPercentage ,isVisited]
	//}
	var simLabel = "";
	var simNode = "";
	var simPercentage = 0;
	for (var i = 0 ; i < graph.nodes.length ; i++)	{
		var node = graph.nodes[i];
		var label = graph.nodes[i].data.label;
		if (label === keyWord)	{
			simNode = node;
			simLabel = label;
			break;
		}
		else {
			var xyz = similar_text(keyWord,label,100);
			if (xyz > simPercentage)	{
				simNode = node;
				simLabel = label;
				simPercentage = xyz;
			}

		}
	}

	//for (var i = 0 ; i < graph.nodes.length ; i++)	{
		var node = simNode;
		//graph.nodes[i];
		var label = simLabel;
		//console.log("b4 trav 1");
		//traverseGraph(simNode,counter);
		var answer = traverseGraph(simNode,keyTag, mostSimilarEdge, mostSimilarPercentage, isVisited,mostSimilarEdgeLabel,counter);
		mostSimilarEdge = answer[0];
		mostSimilarPercentage = answer[1];
		isVisited = answer[2];
		mostSimilarEdgeLabel = answer[3];

		//console.log("after trav 1");
		//console.log("b4 trav 2");
		if (!simNode.incomingEdges)	{
			return [mostSimilarEdge, mostSimilarPercentage, isVisited,mostSimilarEdgeLabel];
		}
		for (var k = 0 ; k < simNode.incomingEdges.length ; k++)	{
			var answer = traverseGraph(simNode.incomingEdges[k].source,keyTag, mostSimilarEdge, mostSimilarPercentage, isVisited,mostSimilarEdgeLabel,counter);
			mostSimilarEdge = answer[0];
			mostSimilarPercentage = answer[1];
			isVisited = answer[2];
			mostSimilarEdgeLabel = answer[3];
			//console.log("after trav 2");

		}

		//graph.nodes[i].data.label;
		//function traverseGraph(node,counter)	{
		
		//if (label === keyWord)	{
		//	traverseGraph();

		//}


	//}
	return [mostSimilarEdge, mostSimilarPercentage, isVisited,mostSimilarEdgeLabel];
	//return "abc";
	//return arr;
}

function traverseGraph(node, keyTag, mostSimilarEdge, mostSimilarPercentage, isVisited,mostSimilarEdgeLabel,counter)	{
			counter-=1;
			if (counter < 5)	{
				//return [null,null,null];
				//return [];
				return [mostSimilarEdge,mostSimilarPercentage,isVisited,mostSimilarEdgeLabel];
			}
			//console.log("in trave graph",node);
			var outgoingEdges = node.outgoingEdges;
			//var mostSimilarEdgeLabel = "";
			
			//var mostSimilarPercentage = 0;
			//var mostSimilarEdge = null;
			//console.log("in trav 2, b4 loop",node,outgoingEdges);
			if (!outgoingEdges)	{
				return [mostSimilarEdge,mostSimilarPercentage,isVisited,mostSimilarEdgeLabel];
			}
			for (var k = 0 ; k < outgoingEdges.length ; k++)	{
				//console.log("in trav 2, in loop",node,outgoingEdges);
				if (!isVisited[outgoingEdges[k].id])	{
					if (outgoingEdges[k].data.label)	{
						//console.log("MEGAHERE",outgoingEdges[k].data.label);
						var tempPercentage = similar_text(keyTag, outgoingEdges[k].data.label, 100);
						//if (tempPercentage === 100)	{
						//	isVisited[outgoingEdges[k].id] = true;
						//	return [outgoingEdges[k],100,isVisited];
						//}
						//console.log("MEGAHERE",outgoingEdges[k].data.label,tempPercentage);
						if (tempPercentage > mostSimilarPercentage)	{
							mostSimilarEdgeLabel = outgoingEdges[k].data.label;

							mostSimilarPercentage = tempPercentage;
							mostSimilarEdge = outgoingEdges[k];
						}
					}
					isVisited[outgoingEdges[k].id] = true;
					//var answer = searchForSimilarLabels(outgoingEdges[k].target.data.label, keyTag, mostSimilarEdge,mostSimilarPercentage, isVisited,counter,mostSimilarEdgeLabel);

					var answer = traverseGraph(outgoingEdges[k].target,keyTag,mostSimilarEdge,mostSimilarPercentage,isVisited,mostSimilarEdgeLabel,counter);
					mostSimilarEdge = answer[0];
					mostSimilarPercentage = answer[1];
					isVisited = answer[2];
					mostSimilarEdgeLabel = answer[3];
				}
			}

			return [mostSimilarEdge,mostSimilarPercentage,isVisited,mostSimilarEdgeLabel];


}

function removeSubarray(arr, start, end)	{

	var temp = [];

	for (var i = 0 ; i < arr.length ; i++)	{
		if (i < start) {
			temp.push(arr[i]);
		}
		else if ( i > end)	{
			temp.push(arr[i]);
		}
	}
	return temp;

}

function getQuestionTag(text)	{
	var text = text.toLowerCase();
	switch(text) {
	case "when":
	  return "date"
	  break;
	case "where":
	  return "location"
	  break;
	default:
	  return "misc"
	}
}

function processQuestion(text)	{
	var arr = preProcess(text);
	//arr = posTagText(text);
	//var str = text;
	//var arr = str.replace(/[^\w\s]|_/g, function ($1) { return ' ' + $1 + ' ';}).replace(/[ ]+/g, ' ').split(' ');
	//console.log("Hello all",arr[0]);
	var questionTag = getQuestionTag(arr[0][0]);
	console.log("MANG",questionTag);
	//return "prob";
	var keyTag = "";
	if (questionTag === "misc")	{
		//return "prob"
		keyTag = arr[0][0];
	}
	var keyWord = "";
	for (var j = 0 ; j < arr[1].length; j++ )	{
		var tag = arr[1][j];
		//console.log("TAGS123",tag)
		var word = arr[0][j];
		if (i === 0)	{
			continue;
		}
		else if (tag.indexOf("NN") === -1) {
			continue;
		}
		else {
			keyWord = word;
		}
	}
	//console.log("HERE",questionTag,keyWord);
	for (var i = 0 ; i < graph.nodes.length ; i++)	{
		var node = graph.nodes[i];
		var label = graph.nodes[i].data.label;
		if (label === keyWord)	{
			
			var outgoingEdges = node.outgoingEdges;
			//console.log("MEGA1",outgoingEdges);
			var mostSimilarPercentage = 0;
			var mostSimilarEdge = null;
			for (var k = 0 ; k < outgoingEdges.length ; k++)	{
				
				if (questionTag === "misc")	{
					if (outgoingEdges[k].data.label)	{
						console.log("MEGAHERE",outgoingEdges[k].data.label);
						var tempPercentage = similar_text(keyTag, outgoingEdges[k].data.label, 100);
						console.log("MEGAHERE",outgoingEdges[k].data.label,tempPercentage);
						if (tempPercentage > mostSimilarPercentage)	{
							mostSimilarPercentage = tempPercentage;
							mostSimilarEdge = outgoingEdges[k];
						}
					}
				}
				else {
					if (questionTag === outgoingEdges[k].data.label)	{
						//(outgoingEdges[k].target.data.label)	{
							
						var str = outgoingEdges[k].target.data.label;
						//console.log("HUFFDAWG",str);
						return str;
						//return outgoingEdges[k].target.data.label;
					}
				}
			}
			if (questionTag === "misc")	{
				console.log("MEGA1",label,keyTag);
				return mostSimilarEdge.target.data.label;
			}

		}

	}
	return "abc";
	//return arr;
}

function posTagText(text)	{
	var wordArray = [];
	var tagArray = [];
	var words = new Lexer().lex(text);
	var taggedWords = new POSTagger().tag(words);
	var result = "";
	for (i in taggedWords) {
	  var taggedWord = taggedWords[i];
	  var word = taggedWord[0];
	  var tag = taggedWord[1];
	  // Note the use of document.writeln instead of print
	  //result += (word + " /" + tag + "<br/>");
	  result += word+" "+tag+" "
	  wordArray.push(word);
	  tagArray.push(tag);
	}
	//document.getElementById("tagged_text").innerHTML = result;
	console.log(result);
	return [result,wordArray,tagArray];
}

function isNoun(tag)	{
	if (tag.indexOf("NN") != -1)	{
		return true;
	}
	return false;
}

function isPRP(tag)	{
	if (tag.indexOf("PRP") != -1)	{
		return true;
	}
	return false;
}

function isDT(tag)	{
	if (tag.indexOf("DT") != -1)	{
		return true;
	}
	return false;
}

function isAdj(tag)	{
	if (tag.indexOf("JJ") != -1)	{
		return true;
	}
	return false;
}

function isCD(tag)	{
	if (tag.indexOf("CD") != -1)	{
		return true;
	}
	return false;
}

/*function isDate(tag)	{
	if (tag.length)	{
	alert("sdasd")
		return true;
	}
	return false;
}*/

function isStop(tag)	{
	if (tag.indexOf(".") != -1)	{
		return true;
	}
	return false;
}

function isCurrency(tag)	{
	if (tag === "$")	{
		return true;
	}
	return false;
}

function isRB(tag)	{
	if (tag.indexOf("RB") != -1)	{
		return true;
	}
	return false;
}

function isCC(tag)	{
	if (tag.indexOf("CC") != -1)	{
		return true;
	}
	return false;
}

function containsLocation(text)	{
	//var arr = ["United States"];//, "Great Britain"];
	var arr = [];
	for (var k = 0 ; k < countries.length ; k++)	{
		arr.push(countries[k].name);
	}
	var str = text;
	var words = str.split(" ");
	//str.replace(/[^\w\s]|_/g, function ($1) { return ' ' + $1 + ' ';}).replace(/[ ]+/g, ' ').split(' ');
	var len = words.length;
	var words2 = words.join(' ');
	var locations = [];
	for (var i = 0 ; i < arr.length ; i++)	{
		//for 
		var location = arr[i];
		if (text.indexOf(location) != -1)	{
			var ind = text.indexOf(location);
			var temp = 0;
			var actualWords = 0;
			for (var j = 0 ; j < words.length ; j++)	{
				if (temp < ind)	{
					temp+= words[j].length+1;
					actualWords += 1;
				}
				else {
					break
				}
			}
			var count = location.match(/ /g);
			if (!count)	{
				locations.push([actualWords, 0]);
			}
			else {
				locations.push([actualWords, count.length+1]);
			}

			//locations.push([text.indexOf(location),location.split(' ').length]);
		}
	}
	if (locations.length > 0)	{
		return locations;
	}
	else {
		return null;
	}
}


function isOppositeComma(tag)	{
	tag = tag.toLowerCase();
	if (tag === 'and' || tag === 'but' || tag === 'or')	{
	//if (tag === ",")	{
	//if (tag === 'and' || tag === 'but' || tag === 'or')	{
		return true;
	}
	return false;

}

function isComma(tag)	{
	tag = tag.toLowerCase();
	//if (tag === 'and' || tag === 'but' || tag === 'or' || tag === ',')	{
	if (tag === ",")	{
	//if (tag === 'and' || tag === 'but' || tag === 'or')	{
		return true;
	}
	return false;
}

function isCommaSpecial(tag)	{
	//tag = tag.toLowerCase();
	//if (tag === 'and' || tag === 'but' || tag === 'or' || tag === ',')	{
	if (tag === "," || isWPD(tag))	{
	//if (tag === 'and' || tag === 'but' || tag === 'or')	{
		return true;
	}
	return false;
}


function isWPD(tag)	{
	tag = tag.toLowerCase();
	if (tag === 'WDT' || tag === 'WP' || tag === 'WP$' || tag === 'WRB')	{
	//if (tag === ",")	{
	//if (tag === 'and' || tag === 'but' || tag === 'or')	{
		return true;
	}
	return false;

}

function preProcess(text)	{
	var locations = containsLocation(text);
	//alert(locations);
	//if (location != -1)	{
		
	//}
	var posTags = posTagText(text);
	var wordArray = posTags[1];
	var sentence = posTags[0];
	var tagArray = posTags[2];
	//alert(locations)
	if (locations)	{
		for (var k = 0 ; k < locations.length; k++)	{
			var temp = locations[k];
			var start = temp[0];
			var len = temp[1];
			
			for (var m = 0 ; m < len ; m++)	{
				//wordArray[]
				var index = start+m
				tagArray[index] = "location";
			}
		}
	}
	console.log("TaGGGGs",tagArray);
	var newWords = [];
	var newTags = [];
	//var streak = true;
	var tempWord = "";
	var tempWord2 = "";
	var tempTag = "";
	var locationTag = "";
	var locationWord = "";
	var prevWord = wordArray[0];
	var prevTag = tagArray[0];
	var validDate = "";
	var pushedOppositeComma = false;
	var nextWord = null;
	var nextTag = null;
	var personalNouns = [];
	var personalN = "";
	var containsPersonal = false;
	for (var i = 0 ; i < wordArray.length; i++)	{
		nextWord = null;
		nextTag = null;
		var word = wordArray[i];
		var tag = tagArray[i];
		if (i != 0)	{
			prevWord = wordArray[i-1];
			prevTag = tagArray[i-1];
		}
		if (i < wordArray.length - 1)	{
			nextWord = wordArray[i+1];
			nextTag = tagArray[i+1];
		}
		
		console.log("HEREWEGO",word,isOppositeComma(word),tag);

		//if (isOppositeComma(word))	{
		//	newWords.push(",,");
		//	newTags.push(",,");
		//	pushedOppositeComma = true;
			//continue;
		//}
		/*if (tag.indexOf("NP") != -1)	{
			if personalN === "")	{
				personalN = word;
			}
			else {
				personalN += " "+word;
			}

		}
		else if (personalN != "")	{
			personalNouns.push(per)
		}*/
		var lowerWord = word.toLowerCase();
		if (tag != "location" && locationWord != "")	{
			//locationWord[0] = "";
			newWords.push(locationWord);
			newTags.push("location");
			if (containsPersonal === true)	{
				personalNouns.push("NNP");
			}
			else {
				personalNouns.push("nope");
			}
			containsPersonal = false;
			locationWord = "";
			//continue;
		}


		if (isOppositeComma(word) || isCommaSpecial(tag))	{
			if (tempWord != "")	{
				newWords.push(tempWord);
				newTags.push("NN");
				if (containsPersonal === true)	{
					personalNouns.push("NNP");
				}
				else {
					personalNouns.push("nope");
				}
				containsPersonal = false;
			}
			if (tempWord2 != "")	{
				newWords.push(tempWord2);
				newTags.push("connector");
				personalNouns.push("nope");
			}
			tempWord = "";
			tempWord2 = "";
			if (isOppositeComma(word)) {
				newWords.push(",,");
				newTags.push(",,");
				personalNouns.push("nope");
				//pushedOppositeComma = true;
			}
			else { /// isComma(word) === true
				//newWords.push(".");
				//newTags.push(".");
				//newWords.push("It");
				//newTags.push("NN");

				newWords.push(",,,");
				newTags.push(",,,");
				personalNouns.push("nope");
			}
			continue;
		}

		/*else if (isComma(word))	{
			newWords.push(",,,");
			newTags.push(",,,");
			
		}*/
		
		else if (lowerWord === "the")	{
			continue;
		}
		//else if (isDT(tag))	{
			//continue;
		//}
		//var tempDate = validDate +" "+ word;
		//if (validDate === "")	{
		//var tempDate = word;

		//}
		/*else if (tag != "location" && locationWord != "")	{
			locationWord[0] = "";
			newWords.push(locationWord);
			newTags.push("location");
			if (containsPersonal === true)	{
				personalNouns.push("NNP");
			}
			else {
				personalNouns.push("nope");
			}
			containsPersonal = false;
			locationWord = "";
			continue;
		}*/
		
		else if (isStop(tag))	{
			if (tempWord != "")	{
				newWords.push(tempWord);
				newTags.push("NN");
				if (containsPersonal === true)	{
					personalNouns.push("NNP");
				}
				else {
					personalNouns.push("nope");
				}
				containsPersonal = false;
			}
			if (tempWord2 != "")	{
				newWords.push(tempWord2);
				newTags.push("connector");
				personalNouns.push("nope");
			}
			newWords.push(".");
			newTags.push(".");
			personalNouns.push("nope");
			tempWord = "";
			tempWord2 = "";
		}
		//else if (word === "July")	{
		//	alert(isValidDate(word));
		//}
		else if (isValidDate(word) === true && !isCurrency(prevTag))	{
			//if (isOppositeComma(word))	{
				//alert("heyo");
				//	newWords.push(",,");
				//	newTags.push(",,");
				//}


			var tempDate = word;
			var dateCounter = 1;
			var m;
			for (m = i+1 ; m < wordArray.length ; m++)	{
				var dWord = wordArray[m];
				//tempDate += " "+dWord;
				if (isValidDate(tempDate+" "+dWord) === false)	{
					//console.log("b4 break");
					break;
				}
				else {
					dateCounter++;
					tempDate += " "+dWord;
				}
			}
			//tempDate
			//console.log("after break",tempDate);

			if (tempWord != "")	{
				//if (tempWord != ",")	{
					newWords.push(tempWord);
					newTags.push("NN");
					if (containsPersonal === true)	{
						personalNouns.push("NNP");
					}
					else {
						personalNouns.push("nope");
					}
					containsPersonal = false;
				//}
				//newWords.push(tempWord);
				//n//ewTags.push("NN");
			}
			if (tempWord2 != "")	{
				//if (tempWord2 != ",")	{
					newWords.push(tempWord2);
					newTags.push("connector");
					
					personalNouns.push("nope");
					
					//containsPersonal = false;
				//}
				//newWords.push(tempWord2);
				//newTags.push("connector");
			}
			tempWord = "";
			tempWord2 = "";
			newWords.push(tempDate);
			newTags.push("number");
			personalNouns.push("nope");
			i = i+dateCounter-1;
			//continue;
			//validDate = "";




		}
		else if (isCD(tag) && !isCurrency(prevTag))	{
			//if (isOppositeComma(word))	{
					//alert("heyo")
					//newWords.push(",,");
					//newTags.push(",,");
				//}
			if (tempWord != "")	{
				newWords.push(tempWord);
				newTags.push("NN");
				if (containsPersonal === true)	{
					personalNouns.push("NNP");
				}
				else {
					personalNouns.push("nope");
				}
				containsPersonal = false;
			}
			if (tempWord2 != "")	{
				newWords.push(tempWord2);
				newTags.push("connector");
				personalNouns.push("nope");
			}
			tempWord = "";
			tempWord2 = "";
			newWords.push(word);
			newTags.push("number");
			personalNouns.push("nope");
		}
		//else if (isCurrency(tag))	{
			
		//}

		else if (isPRP(tag) || isNoun(tag) || isAdj(tag) || isRB(tag) || isCurrency(tag) || isCurrency(prevTag))	{

			/*if (i < tagArray.length - 1 && tagArray[i+1] === "IN")	{
				if (tempWord != "")	{
					newWords.push(tempWord+" "+word);
					
					newTags.push("NN");
					
					if (containsPersonal === true)	{
						personalNouns.push("NNP");
					}
					else {
						personalNouns.push("nope");
					}
					containsPersonal = false;
				}
				else {
					newWords.push(word);
					
					newTags.push("NN");
				}
				if (tempWord2 === "")	{
					tempWord2 += wordArray[i+1];
				}
				else {
					tempWord2 += " "+wordArray[i+1];
				}
				tempWord = "";
				i = i+1;
				continue;

			}*/

			if (tag.indexOf("NP") != -1)	{
				containsPersonal = true;
			}
				
				/*else if (isComma(tag))	{
					newWords.push(",");
					newTags.push(",");

				}*/
			if (tempWord2 != "")	{
				newWords.push(tempWord2);
				newTags.push("connector");
				personalNouns.push("nope");
			}
			tempWord2 = "";
			if (tempWord === "")	{
				tempWord += word;
			}
			else {
				tempWord += " "+word
			}
		}
		else if (tag === "location")	{
			if (tempWord != "")	{
				newWords.push(tempWord);
				newTags.push("NN");
				if (containsPersonal === true)	{
					personalNouns.push("NNP");
				}
				else {
					personalNouns.push("nope");
				}
				containsPersonal = false;
			}
			if (tempWord2 != "")	{
				newWords.push(tempWord2);
				newTags.push("connector");
				
				personalNouns.push("nope");
				
				//containsPersonal = false;
			}
			tempWord = "";
			tempWord2 = "";
			if (locationWord === "")	{
				locationWord += word;
			}
			else {
				locationWord += " "+word;
			}
			//newWords.push(word);
			//newTags.push("location");
		}
		
		else {
			if (tempWord != "")	{
				newWords.push(tempWord);
				//if (tag === "location")	{
				//	alert(tag);
				//	newTags.push("location");
				//}
				//else {
					newTags.push("NN");
				//}
				if (containsPersonal === true)	{
					personalNouns.push("NNP");
				}
				else {
					personalNouns.push("nope");
				}
				containsPersonal = false;
			}
			if (tempWord2 === "")	{
				tempWord2 += word;
			}
			else {
				tempWord2 += " "+word
			}
			tempWord = "";
		}

		//if (isComma(word))	{
		//	alert(nextTag);
		//}
		//if (isComma(word) && pushedOppositeComma === false)	{
		/*if (isComma(word) && pushedOppositeComma === false)	{
			newWords.push(",,,");
			newTags.push(",,,");
			
		}
		else if (isComma(word) && nextTag && isWPD(nextTag)) {
			
			for (var n = newWords.length-1; n >= 0;n--)	{
				if (newWords[n] === ",,")	{
					
					newWords.splice(n, 1);
					newTags.splice(n, 1);
					break;
				}
			}
			newWords.push(",,,");
			newTags.push(",,,"); 
		}
		pushedOppositeComma = false;*/
	}
	console.log(newWords);
	console.log(newTags);
	console.log("afefuiwueiua",newWords.length === newTags.length, personalNouns.length === newTags.length, personalNouns);
	var finalWords = [];
	var finalTags = [];
	for (var j = 0 ; j < newWords.length ; j++)	{
		

		//if (!isOppositeComma(newWords[j]))	{
			finalWords.push(newWords[j]);
			finalTags.push(newTags[j]);

		//}
		

	}
	return [finalWords,finalTags];//,personalNouns];
}

function processText(text)	{
	//alert("hey");
	var arr = preProcess(text);
	newWords = arr[0];
	newTags = arr[1];
	var obj = null;
	var listOfObjs = [];
	var subject = "";
	var mainSubject = "";
	var turn = false;
	var previousWord = newWords[0];
	//var listofNodes =
	//var timeFrame = {};
	var firstConnector = null;

	function findConnectorNode(text,connector)	{
		var iter = 50;
		var array = listOfObjs.slice(0);
		var temp = findParent(text,connector,array, iter);
		if (temp)	{
			var next = temp['next'];
			var prev = temp['prev'];
			var connect = temp['connector'];
			for (var i = 0 ; i < listOfObjs.length ; i++)	{
				var temp2 = listOfObjs[i];
				var next2 = temp2['next'];
				var prev2 = temp2['prev'];
				var connect2 = temp2['connector'];
				if (prev === prev2 && connect2 === connector)	{
					return next2;
				}
			}
		}
		else {
			return null;
		}
	}
	
	function findParent(text,connector,array, iter)	{
			iter-=1;
			if (iter < 2)	{
				return null;
			}
		//while (true)	{
			for (var i = 0 ; i < array.length ; i++)	{
				var temp = array[i];
				var next = temp['next'];
				var prev = temp['prev'];
				var connect = temp['connector'];
				if (text === next)	{
					var result = findParent(prev,connector,array.splice(i,1), iter);
					if (!result)	{
						//if (connector)	{
						return temp;	
						//}
						//else {
						
						//}
					}
					//if ()	{
					
					//}
				}
				//else if (text === prev)	{
					//return ;
				//}
				
			}
			return null;
		//}
	}
	
	function typeNN(relation)	{
		//if (relation && relation.length < 2)	{
		//	alert("probs");
		//}
		if (relation)	{
			obj['connector'] = relation;
		}
		if (subject != "")	{

			if (!obj['previous'])	{

				obj['previous'] = subject;
				obj['next'] = word;
				if (!relation)	{
					subject = word;
				}
			}
			else {
				obj['next'] = word;
				subject = "";
			}
			if (!obj['connector'])	{
				obj = null;
			}
			else {
				listOfObjs.push(obj);
				obj = null;
			}
		}
		else {
			if (mainSubject != "")	{

				obj['previous'] = mainSubject;
				obj['next'] = word;
				if (obj['connector'])	{
					//alert(mainSubject+" "+word);
					listOfObjs.push(obj);
					if (!relation)	{
						subject = word;
					}
				}
				else {
					subject = mainSubject;
				}
				//listOfObjs.push(obj);
				obj = null;
				//subject = word;
			}
			else {
				obj = {};
				console.log("MAINSUBBBBB",mainSubject);
				mainSubject = word;
				console.log("MAINSUBBBBB",mainSubject);
				if (!relation)	{
					subject = word;
				}
				obj['previous'] = word;
			}
		}
	}
		
	for (var j = 0 ; j < newWords.length ; j++)	{

			/*function doubleComma()	{
				var tempC = {};
				
				if (subject && subject != "")	{
					tempC['previous'] = subject;
				}
				else {
					tempC['previous'] = mainSubject;
				}

				var dateCounter = 1;
				var m = j+1;
				
				var prevObj = listOfObjs[listOfObjs.length -1];

				var dWord = newWords[m];
				var dTag = newTags[m];

				if (dTag === "NN")	{
					tempC['next'] = dWord;
					

				for (var n = j-1 ; n >= 0 ; n--)	{
					var pWord = newWords[n];
					var pTag = newTags[n];
					if (pTag === "connector")	{
						tempC['connector'] = pWord;
						break
					}
				}


					
				}
				else if (dTag === "connector")	{
					tempC['connector'] = dWord;
					
					for (var n = j+1 ; n < newWords.length ; n++)	{
						var pWord = newWords[n];
						var pTag = newTags[n];
						if (pTag === "NN")	{
							tempC['next'] = pWord;
							break
						}
					}
					
				}

				
				console.log("asanasflanlkdf",tempC)
				j = j+1;

				listOfObjs.push(tempC);
				tempC = null;
			}*/
			var word = newWords[j];
			var tag = newTags[j];

			//var nextW = null;
			//var nextT = null;

			if (j != 0)	{
				previousWord = newWords[j-1];
			}
			//if (previousWord ===)	{
			
			//}
			if (!obj)	{
				obj = {};
			}
			//console.log("XXXXXXXXRREEE", mainSubject, subject,word);
			//if (word.toLowerCase() === "he")	{
			//	console.log("XXXXXXXXRREEE", mainSubject, subject);
			//}

			if (j < newWords.length - 1 && reClassify(word, newTags[j+1]))	{
				var replaceObj = {};
				var adjunctObj = {};
				var prevObj = listOfObjs[listOfObjs.length -1];
				console.log('PREEEVOBBJJ',prevObj);
				replaceObj['previous'] = newWords[j+1];//word;
				replaceObj['connector'] = prevObj['connector'];
				replaceObj['next'] = prevObj['next'];
				adjunctObj['previous'] = replaceObj['previous'];
				adjunctObj['connector'] = "is";
				adjunctObj['next'] = prevObj['previous'];

				//listOfObjs.push(replaceObj);
				//console.log('PREEEVOBBJJ222',replaceObj);
				listOfObjs[listOfObjs.length -1] = replaceObj;
				listOfObjs.push(adjunctObj);
				//j = j+1;
				//prevObj['previous'];

			}
			else if (word === ",,")	{
				//alert(pWord);
				/*function doubleComma()	{
				var tempC = {};
				
				tempC['previous'] = mainSubject;
				

				var dateCounter = 1;
				var m = j+1;
				
				var prevObj = listOfObjs[listOfObjs.length -1];

				var dWord = newWords[m];
				var dTag = newTags[m];

				if (dTag === "NN")	{
					tempC['next'] = dWord;
					

				for (var n = j-1 ; n >= 0 ; n--)	{
					var pWord = newWords[n];
					var pTag = newTags[n];
					if (pTag === "connector")	{
						tempC['connector'] = pWord;
						break
					}
				}


					
				}
				else if (dTag === "connector")	{
					tempC['connector'] = dWord;
					
					for (var n = j+1 ; n < newWords.length ; n++)	{
						var pWord = newWords[n];
						var pTag = newTags[n];
						if (pTag === "NN")	{
							tempC['next'] = pWord;
							break
						}
					}
					
				}

				
				console.log("asanasflanlkdf",tempC)
				j = j+1;

				listOfObjs.push(tempC);
				tempC = null;
				}*/
				//doubleComma();

				var tempC = {};
				tempC['previous'] = "";
				tempC['connector'] = "";
				tempC['next'] = "";
				var gotDot = false;
				var gotComma = false;
				var gotConnector = false;
				var gotNN = false;
				var gotAnd = false;
				var lastConnector = false;
				var fatherSubject = null;
				var prevObj = listOfObjs[listOfObjs.length - 1];
				//console.log("AFBAFBSDAJFDSFJSDJFJDSNJ222",prevObj,newWords[j+1]);
				if (

					(newTags[j+1] === "NN" && j > 1 && newTags[j-2] === ".")
					||
					(newTags[j+1] === "NN" && j === 1)

					)	{
					console.log("AFBAFBSDAJFDSFJSDJFJDSNJ222",prevObj,newWords[j+1]);
					//console.log(".............");
					
					/// Sample: Tom Hanks was a Batsman. He and (^) Gary won Award.


					//tempC['previous'] = prevObj['previous'];
					//firstConnector = null;
					//if firstConnector)	{

					//}
					fatherSubject = newWords[j+1];
					for (var n = j+2 ; n < newTags.length ; n++)	{
						if (newTags[n] === "NN" && gotConnector != false
							&& gotComma === false && gotDot === false
							)	{

							/// He and Gary won Award

							var tempD ={};
							tempD['previous'] = fatherSubject; //newWords[j+1];
							tempD['connector'] = gotConnector;
							tempD['next'] = newWords[n];
							
							
							tempC['previous'] = prevObj['previous'];
							tempC['connector'] = gotConnector;
							tempC['next'] = newWords[n];

							listOfObjs.push(tempC);
							listOfObjs.push(tempD);

							j = n;
							subject = newWords[n];
							break;

							///gotConnector = false;



						}

						else if (newTags[n] === "NN" && gotConnector != false
							&& gotComma === true && gotDot === false
							)	{

							/// He and Gary won Award

							var tempD ={};
							tempD['previous'] = fatherSubject; //newWords[j+1];
							tempD['connector'] = gotConnector;
							tempD['next'] = newWords[n];
							
							
							//tempC['previous'] = prevObj['previous'];
							//tempC['connector'] = gotConnector;
							//tempC['next'] = newWords[n];

							//listOfObjs.push(tempC);
							//listOfObjs.push(tempD);

							listOfObjs.unshift(tempC);
							listOfObjs.unshift(tempD);

							//////j = n;
							//////subject = newWords[n];
							//////break;
							lastConnector = gotConnector;
							gotConnector = false;




						}
						/*else if (newTags[n] === "connector" && gotNN === false
							&& gotComma === false && gotDot === false
							)	{

							gotConnector = newWords[n];

						}*/

						else if (newTags[n] === "connector")	{
							gotConnector = newWords[n];
						}

						else if ( newTags[n] === ",,," && gotComma === true)	{




							newWords = removeSubarray(newWords, j+2, n);
							newTags = removeSubarray(newTags, j+2, n);
							j = j - 2;
							//j = n;
							//subject = newWords[n];
							break;							

						}
						else if (newTags[n] === ",," && gotAnd === false)	{
							gotAnd = true;

							console.log("HEY IF HEARD",gotConnector,lastConnector);
							if (newTags[n+1] === "NN" && lastConnector != false)	{

								var tempD ={};
								tempD['previous'] = newWords[j+1];
								tempD['connector'] = lastConnector;
								tempD['next'] = newWords[n+1];
								listOfObjs.unshift(tempD);
								fatherSubject = newWords[n+1];

							}
							//fatherSubject = newWords[j+1];
							//else 
						}
						else if (newTags[n] === ",,," && gotComma === false)	{
							gotComma = true;
						}
						/*if (newTags[n] === ".")	{
							tempC['previous'] = prevObj['previous'];
							tempC['connector'] = prevObj['connector'];
							tempC['next'] = newWords[j+1];
							break;
						}
						else if (newTags[n] === "connector")	{
							tempC['previous'] = newWords[j+1];
							tempC['connector'] = newWords[n];
							tempC['next'] = 
							break;
						}*/

					}

					//var tempD = {};
					//tempD['previous'] = 
					//prevObj['previous'];
					////////////
					/*tempC['previous'] = prevObj['previous'];
						tempC['connector'] = prevObj['connector'];
						tempC['next'] = newWords[j+1];//prevObj['next'];
						subject = tempC['previous'];
						listOfObjs.push(tempC);
						tempC = null;
						j = j+1;*/

					////////////////
					/*if (newTags[j+2] === ".")	{
						tempC['previous'] = prevObj['previous'];
						tempC['connector'] = prevObj['connector'];
						tempC['next'] = newWords[j+1];//prevObj['next'];
						subject = tempC['previous'];
						listOfObjs.push(tempC);
						tempC = null;
						j = j+1;
					}
					else {
						var tempD = {};
						for (var n = j+2 ; n < newWords.length ; n++)	{
							if ()	{

							}
						}
						
						tempC['previous'] = prevObj['previous'];
						tempC['connector'] = prevObj['connector'];
						tempC['next'] = newWords[j+1];
						subject = tempC['previous'];
						listOfObjs.push(tempC);
						tempC = null;
						j = j+1;
					}*/

					//tempC['previous'] = prevObj['previous'];
					//tempC['connector'] = prevObj['connector'];
					//tempC['next'] = newWords[j+1];//prevObj['next'];
					//listOfObjs.push(tempC);
					//tempC = null;
					//j = j+1;
				}
				/*else {
					tempC['previous'] = prevObj['previous'];
					tempC['connector'] = newWords[j+1];
					tempC['next'] = newWords[j+2];
					subject = tempC['previous'];
					listOfObjs.push(tempC);
					tempC = null;
					j = j+2;

				}*/
				else if (newTags[j+1] === "NN")	{
					tempC['previous'] = prevObj['previous'];
					tempC['connector'] = prevObj['connector'];
					tempC['next'] = newWords[j+1];//prevObj['next'];
					subject = tempC['previous'];
					listOfObjs.push(tempC);
					tempC = null;
					j = j+1;
				}
				else {
					tempC['previous'] = prevObj['previous'];
					tempC['connector'] = newWords[j+1];
					tempC['next'] = newWords[j+2];
					subject = tempC['previous'];
					listOfObjs.push(tempC);
					tempC = null;
					j = j+2;

				}


			}
			else if (word === ",,,")	{

				function subSentenceComma(starterWord, startIndex, iter)	{

					//// SAMPLE: "Tom Hanks was a Batsman. He, Gary Sinise, who was (^) Bowler and founded Hinduism, and Laure Singh won Best Actor . "

					//// starterWord = Gary Sinise

					//// starter Index = where "who was" is

					iter -= 1;
					if (iter < 5)	{
						return startIndex;
					}
					var encounteredNN = false;
					var encounteredDoubleComma = false;
					var encounteredConnector = false;
					for (y = startIndex ; y < newWords.length ; y++)	{

						if (newTags[y] === "connector")	{

							//// NOTE: we are at "who was"
							encounteredConnector = newWords[y];
						}
						else if (newTags[y] === "NN" && encounteredConnector != false)	{


							//// NOTE: we are at Bowler

							var tempE = {};
							//encounteredNN = new
							tempE['previous'] = starterWord;
							tempE['connector'] = encounteredConnector;
							tempE['next'] = newWords[y];
							listOfObjs.push(tempE);


						}
						else if (newTags[y] === ",,,")	{

							//j = y;
							return y;
						}
						//else if (newTags[y] === "NN" && encounteredConnector === false)	{

						//}

						else if (newTags[y] === ",,")	{

							//// NOTE: , and before Laure is just ",," so we need to know the end of the subSentence.

							//console.log("HIP HIP HOORAY");

							for (z = y+1 ; z < newWords.length ; z++)	{

								if (newTags[z] === ".")	{
									//console.log("HIP HIP HOORAY");
									return y;
								}
								else if (newTags[z] === ",,," || newTags[z] === ",,")	{
									console.log("HIP HIP HOORAY");
									return subSentenceComma(starterWord, y+1, iter);
								}

							}
						}

					}


				}



				var tempC = {};
				var prevObj = listOfObjs[listOfObjs.length - 1];
				console.log('PREEEVOBBJJ',prevObj);
				if (obj && obj['connector'] && obj['connector'] != "") {
					//obj['connector'] = ;
					obj['previous'] = prevObj['next'];;
					//console.log("AFBAFBSDAJFDSFJSDJFJDSNJ",obj);
					for (var n = j+1 ; n < newWords.length ; n++)	{
						if (newTags[n] === "NN")	{
							obj['next'] = newWords[n];
							//j = n;
							listOfObjs.push(obj);
							obj = null;
							break;
						}
					}
				}	
				//var prevObj = listOfObjs[listOfObjs.length - 1];
				if ((j > 1 && newTags[j-2] === "." && newTags[j-1] === "NN")

					||

					(j === 1 && newTags[j-1] === "NN")
					)	{

					//console.log("appappppepepe");
					/// 1: Hanks was a Batsman . He ,(^) Gary and Laura won Award .

					///  OR

					/// 2: "Tom Hanks was a Batsman. He ,(^) Gary Sinise , who was Bowler , James Dorian and Laure Singh won Best Actor . "

					var gotDot = false;
					var gotDoubleComma = false;
					var gotTripleComma = false;
					var gotComma = false;
					var gotConnector = false;
					var gotNN = false;
					for (var n = j+1 ; n < newWords.length; n++)	{


						if (newTags[n] === ",,,"
							&& newTags[n+1] === "connector"
							&& gotNN != false
							&& gotConnector === false
							)	{

							/// NOTE 2: at comma after Sinise

							//var tempE = {};


							//for (var y = 0 ; y < gotNN.length ; y++)	{
								//gotNN[gotNN.length - 1];
							n = subSentenceComma(gotNN[gotNN.length - 1], n+1,20);

							

							//}
						}


						else if (newTags[n] === "NN" &&
							gotNN != false &&
							gotConnector != false
							
							)	{
							if (j > 1 && newTags[j-2] === "." && newTags[j-1] === "NN")	{
								tempC['previous'] = mainSubject;//newWords[j-1];
							}
							else {
								tempC['previous'] = newWords[j-1];
							}
							tempC['connector'] = gotConnector;
							tempC['next'] = newWords[n];
							listOfObjs.push(tempC);
							/// NOTE 1: at Award

							for (var y = 0 ; y < gotNN.length ; y++)	{
								var tempD = {};
								tempD['previous'] = gotNN[y];
								tempD['connector'] = gotConnector;
								tempD['next'] = newWords[n];
								listOfObjs.push(tempD);
							}
							subject = newWords[n];
							j = n;
							break;


						}
						else if (newTags[n] === "connector" &&
								gotNN != false &&
								gotConnector === false
								


							)	{

							/// NOTE 1: at won

							gotConnector = newWords[n];

						}
						else if (newTags[n] === "NN" &&
								gotNN === false &&
								gotConnector === false
								


							)	{

							/// NOTE 1: at Gary

							gotNN = [];
							gotNN.push(newWords[n]);

						}
						else if (newTags[n] === "NN" &&
								gotNN != false &&
								gotConnector === false
								


							)	{

							/// NOTE 1: at Laura

							//gotNN = [];
							gotNN.push(newWords[n]);

						}


					}



				}
				else if (newTags[j+1] === "NN")	{
					tempC['previous'] = prevObj['previous'];
					tempC['connector'] = prevObj['connector'];
					tempC['next'] = newWords[j+1];//prevObj['next'];
					//subject = tempC['previous'];
					subject = tempC['next'];
					console.log("ahsdasbdhhhhh",subject);
					console.log("MAINSUBBBBB",mainSubject);
					mainSubject = tempC['previous'];
					console.log("MAINSUBBBBB",mainSubject);
					//subject;
					listOfObjs.push(tempC);
					tempC = null;
					j = j+1;
				}
				else {
					//console.log("ahsdasbdhhhhh");
					tempC['previous'] = prevObj['next'];
					tempC['connector'] = newWords[j+1];
					for (var n = j+2 ; n < newWords.length ; n++)	{
						if (newTags[n] === "NN")	{
							tempC['next'] = newWords[n];
							//j = n;
							break;
						}
					}
					console.log("ahsdasbdhhhhh222",",",subject,",",tempC['previous']);
					//subject = tempC['next'];
					
					//mainSubject = tempC['previous'];
					subject = tempC['previous'];
					console.log("MAINSUBBBBB",mainSubject);
					mainSubject = subject;
					console.log("MAINSUBBBBB",mainSubject);
					listOfObjs.push(tempC);
					tempC = null;
					j = j+1;

				}
				
				//tempC['previous'] = subject;
				

				//var dateCounter = 1;
				//var m = j+1;
				
				//var prevObj = listOfObjs[listOfObjs.length - 1];
				//console.log("AFNJAFJASNFKJASF JKSADNFKJSADNFKNSDKJ",prevObj['next'],subject);
				//tempC['previous'] = prevObj['next'];
				//var dWord = newWords[m];
				//var dTag = newTags[m];

				//if (dTag === "NN")	{
				//	tempC['previous'] = dWord;
				//}
				/*tempC['connector'] = "";
				tempC['next'] = "";
				for (var n = j+1 ; n < newWords.length ; n++)	{

					var pWord = newWords[n];
					var pTag = newTags[n];
					if (pTag === "connector")	{
						
						tempC['connector'] = pWord;
						
					}
					else {
						if (tempC['connector'] === "")	{

							doubleComma();
							break;
						}
						else {
							tempC['next'] = pWord;
							j = n;

							listOfObjs.push(tempC);
							tempC = null;
							break;
						}
					}

				}*/

				//j = n;

				//listOfObjs.push(tempC);
				//tempC = null;


			}
			/*else if (word === ",")	{
				var temp = {};
				temp['next'] = timeFrame;
				temp['previous'] = mainSubject;
				temp['connector'] = 'date';
				listOfObjs.push(temp);
				temp = null;
			}*/
			else if (word.indexOf('during') != -1)	{
				//alert(word);
				//alert(subject);
				if (subject != "")	{
					var timeFrame = findConnectorNode(subject,"date");
					var temp = {};
					temp['next'] = timeFrame;
					temp['previous'] = subject;
					temp['connector'] = 'date';
					listOfObjs.push(temp);
					temp = null;
				}
				else {
					var timeFrame = findConnectorNode(mainSubject,"date");
					var temp = {};
					temp['next'] = timeFrame;
					temp['previous'] = mainSubject;
					temp['connector'] = 'date';
					listOfObjs.push(temp);
					temp = null;
				}
				if (tag === 'connector')	{
					if (obj)	{
						//if (!word || word.length === 0)	{
						//alert("probs");
					//}
						obj['connector'] = word;
					}
				}
			}
			else if (tag === 'connector')	{
				firstConnector = word;
				//if (word === "Released in")	{
				//	batdog = obj;
				//	console.log("hahaha" );
				//	alert("fasdasd");
				//}
				if (obj)	{
					//if (!word || word.length === 0)	{
					//	alert("probs");
					//}
					obj['connector'] = word;
				}
			}
			else if (tag === "number")	{
				//timeFrame[mainSubject] = word;
				//timeFrame[subject] = word; 				
				if (subject === "")	{
					var x = newWords[j+1];
					//var y = ]
					newWords[j+1] = word;//newWords[j];
					newWords[j] = x;
					//newTags[j+1] = tag;
					var y = newTags[j+1];
					newTags[j+1] = tag;
					newTags[j] = y;
					tag = y;
					
					//newTags[j] = 
					word = x;
					typeNN();
				}
				else {
					//timeFrame = word;
					var temp = {};
					temp['previous'] = subject;
					temp['connector'] = 'date';
					temp['next'] = word;
					listOfObjs.push(temp);
					temp = null;
					//subject = word;
				}
				
			}
			/*else if (word.indexOf('during') != -1)	{
				alert(word);
				alert(subject);
				if (subject != "")	{
					var timeFrame = findConnectorNode(subject,"date");
					var temp = {};
					temp['next'] = timeFrame;
					temp['previous'] = subject;
					temp['connector'] = 'date';
					listOfObjs.push(temp);
					temp = null;
				}
				else {
					var timeFrame = findConnectorNode(mainSubject,"date");
					var temp = {};
					temp['next'] = timeFrame;
					temp['previous'] = mainSubject;
					temp['connector'] = 'date';
					listOfObjs.push(temp);
					temp = null;
				}
			}*/
			else if (tag === "NN")	{
				typeNN();
			}
			else if (tag === "location")	{
				typeNN("location");
			}
			else if (tag === ".")	{
				firstConnector = null;
				var subNodeLabel;
				//mainSubject
				if (j < newWords.length - 1)	{
					nextWord = newWords[j+1];
					if (existsInListOfObjs(listOfObjs, nextWord) === true) {
						mainSubject = "";
						//subject = "";
					}
					else if ((subNodeLabel = existsInListOfObjsSubStr(listOfObjs, nextWord))[1] === true)	{
						
						console.log("FFFFFFFFFF",mainSubject,"HHHHHHHHHH",nextWord,subNodeLabel[0]);
						mainSubject = "";
						//mainSubject = subNodeLabel[0];
						newWords[j+1] = subNodeLabel[0];
					}
					/*else {
						
						mainSubject = 
					}*/
				}
				subject = "";
				obj = null;
			}
	
	}
	console.log("MAINSUBBBBB",newWords);
	return listOfObjs;
	
}



function existsInListOfObjs(listOfObjs, nextWord)	{
	nextWord = nextWord.toLowerCase();
	for (var i = 0 ; i < listOfObjs.length ; i++)	{
		var temp = listOfObjs[i];
		var next = temp['next'].toLowerCase();
		var previous = temp['previous'].toLowerCase();
		var connect = temp['connector'].toLowerCase();
		if (next === nextWord || previous === nextWord)	{
			return true;
		}
	}
	return false;
}

function existsInListOfObjsSubStr(listOfObjs, nextWord)	{
	nextWord = nextWord.toLowerCase();
	for (var i = 0 ; i < listOfObjs.length ; i++)	{
		var temp = listOfObjs[i];
		var next = " "+temp['next'].toLowerCase()+" ";
		var previous = " "+temp['previous'].toLowerCase()+" ";
		var connect = " "+temp['connector'].toLowerCase()+" ";
		if (next && next.indexOf(" "+nextWord+" ") != -1)	{
			return [temp['next'],true];
		}
		else if (previous && previous.indexOf(" "+nextWord+" ") != -1)	{
			return [temp['previous'],true];
		}
	}
	return [null,false];
}


function createGraph(obj)	{
	graph = new Springy.Graph();
	var dict = {};
	for (var i = 0 ; i < obj.length ; i++)	{
		var value = obj[i];
		var previous = value['previous'];
		var previousL = previous.toLowerCase();
		var connector = value['connector'];
		var connectorL = connector.toLowerCase();
		var next = value['next'];
		var nextL = next.toLowerCase();
		if (dict[previous] || dict[previousL])	{
			if (dict[next] || dict[nextL])	{
				//if (dict[connectr])	{
				
				//}
				graph.newEdge(dict[previous], dict[next], {color: '#00A0B0', label: connector});
			}
			else {
				dict[next] = graph.newNode({label: next});
				dict[nextL] = dict[next];
				graph.newEdge(dict[previous], dict[next], {color: '#00A0B0', label: connector});
				
			}
		}
		else if (dict[next] || dict[nextL])	{
			dict[previous] = graph.newNode({label: previous});
			dict[previousL] = dict[previous];
			graph.newEdge(dict[previous], dict[next], {color: '#00A0B0', label: connector});
		}
		else {
			dict[previous] = graph.newNode({label: previous});
			dict[previousL] = dict[previous];
			dict[next] = graph.newNode({label: next});
			dict[nextL] = dict[next];
			graph.newEdge(dict[previous], dict[next], {color: '#00A0B0', label: connector});
		}
	}
	jQuery(function(){
	  var springy = window.springy = jQuery('#springydemo').springy({
		graph: graph,
		nodeSelected: function(node){
		  console.log('Node selected: ' + JSON.stringify(node.data));
		}
	  });
	});
}




function similar_text(first, second, percent) {
  //  discuss at: http://phpjs.org/functions/similar_text/
  // original by: Rafał Kukawski (http://blog.kukawski.pl)
  // bugfixed by: Chris McMacken
  // bugfixed by: Jarkko Rantavuori original by findings in stackoverflow (http://stackoverflow.com/questions/14136349/how-does-similar-text-work)
  // improved by: Markus Padourek (taken from http://www.kevinhq.com/2012/06/php-similartext-function-in-javascript_16.html)
  //   example 1: similar_text('Hello World!', 'Hello phpjs!');
  //   returns 1: 7
  //   example 2: similar_text('Hello World!', null);
  //   returns 2: 0

  if (first === null || second === null || typeof first === 'undefined' || typeof second === 'undefined') {
    return 0;
  }

  first += '';
  second += '';

  var pos1 = 0,
    pos2 = 0,
    max = 0,
    firstLength = first.length,
    secondLength = second.length,
    p, q, l, sum;

  max = 0;

  for (p = 0; p < firstLength; p++) {
    for (q = 0; q < secondLength; q++) {
      for (l = 0;
        (p + l < firstLength) && (q + l < secondLength) && (first.charAt(p + l) === second.charAt(q + l)); l++)
      ;
      if (l > max) {
        max = l;
        pos1 = p;
        pos2 = q;
      }
    }
  }

  sum = max;

  if (sum) {
    if (pos1 && pos2) {
      sum += this.similar_text(first.substr(0, pos1), second.substr(0, pos2));
    }

    if ((pos1 + max < firstLength) && (pos2 + max < secondLength)) {
      sum += this.similar_text(first.substr(pos1 + max, firstLength - pos1 - max), second.substr(pos2 + max,
        secondLength - pos2 - max));
    }
  }

  if (!percent) {
    return sum;
  } else {
    return (sum * 200) / (firstLength + secondLength);
  }
}

// Represent graph as dictionary 
function createGraphDict() {
	var edges = graph.edges;
	for (var i = 0; i < edges.length; i++) {
		var curEdge = edges[i];
		var edgeLabel = cur.data.label;
		var sLabel = curEdge.source.data.label;
		var tLabel = curEdge.target.data.label;
		if (!(sLabel in gGraphDict)) {
			var curArray = [];
			curArray.push([tLabel, edgeLabel]);
			gGraphDict[sLabel] = curArray;
		}
		else {
			gGraphDict[sLabel].push([tLabel, edgeLabel]);
		}
	}
}


function createSubGraphs(size) {
	// Go through each node
	for (var node in gGraphDict) {
		var curSet = [];
		var curNode = node;
		curSet.push(curNode);
		var tooSmallFlag = false;

		// Generate subgraph by walking the neighbors
		while (curSet.length < size) {
			var curTargets = gGraphDict[curNode];
			if (curTargets.length == 0) {
				tooSmallFlag = true;
				break;
			}
			else {
				for (var i = 0; i < curTargets.length; i++) {
					var cTarget = curTarget[i][0];
					if (!(cTarget in curSet)) {
						curSet.push(cTarget);
						curNode = cTarget;
						break;
					}
				}
			}
		}

		if (!tooSmallFlag) {
			var names = [];
			for (var subGraphNode in curSet) {
				names.push(subGraphNode.data.label);
			}
			names.sort();
			var stringKey = "";
			for (var i = 0; i < names.length; i++) {
				stringKey += names[i];
			}
			subGraphs[stringKey] = curSet;
		}
	}
}

function generateQuestions() {
	var prefix = "What thing "; // Hacky as fuck 
	var questions = "";
	// Currently assuming only subgraphs of size 2, lol
	for (var stringKey in subGraphs) {
		var curQ = prefix;
		var curSet = subGraphs[stringKey];
		if (curSet.length == 2) {
			var src;
			var trg;
			if (curSet[0] in curSet[1]) {
				src = curSet[1];
				trg = curSet[0];
			}
			else {
				src = curSet[0];
				trg = curSet[1];
			}
			var srcTargets = gGraphDict[src];
			for (var i = 0; i < srcTargets.length; i++) {
				var curTarget = srcTargets[0];
				if (curTarget == trg) {
					curQ += srcTargets[1] + " " + curTarget + "?";
				}
			}
			questions += curQ + "\n";
		}
		return questions;
	}


}

/*
var graph = new Springy.Graph();

var dennis = graph.newNode({
  label: 'Dennis',
  ondoubleclick: function() { console.log("Hello!"); }
});
var michael = graph.newNode({label: 'Michael'});
var jessica = graph.newNode({label: 'Jessica'});
var timothy = graph.newNode({label: 'Timothy'});
var barbara = graph.newNode({label: 'Barbara'});
var franklin = graph.newNode({label: 'Franklin'});
var monty = graph.newNode({label: 'Monty'});
var james = graph.newNode({label: 'James'});
var bianca = graph.newNode({label: 'Bianca'});

graph.newEdge(dennis, michael, {color: '#00A0B0'});
graph.newEdge(michael, dennis, {color: '#6A4A3C'});
graph.newEdge(michael, jessica, {color: '#CC333F'});
graph.newEdge(jessica, barbara, {color: '#EB6841'});
graph.newEdge(michael, timothy, {color: '#EDC951'});
graph.newEdge(franklin, monty, {color: '#7DBE3C'});
graph.newEdge(dennis, monty, {color: '#000000'});
graph.newEdge(monty, james, {color: '#00A0B0'});
graph.newEdge(barbara, timothy, {color: '#6A4A3C'});
graph.newEdge(dennis, bianca, {color: '#CC333F'});
graph.newEdge(bianca, monty, {color: '#EB6841'});

jQuery(function(){
  var springy = window.springy = jQuery('#springydemo').springy({
    graph: graph,
    nodeSelected: function(node){
      console.log('Node selected: ' + JSON.stringify(node.data));
    }
  });
});*/
</script>

<canvas id="springydemo" width="1640" height="700" />
</body>
</html>